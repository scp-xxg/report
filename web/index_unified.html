<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多智能体报告生成系统</title>
    <link rel="stylesheet" href="style_improved.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta name="description" content="AI驱动的多智能体报告生成系统，支持多种大模型和输出格式">
    <meta name="keywords" content="AI,报告生成,多智能体,人工智能,研究报告">
</head>
<body>
    <div class="app-container">
        <!-- 侧边栏 -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-robot"></i>
                    <span class="logo-text">AI报告系统</span>
                </div>
                <button class="sidebar-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h3>功能导航</h3>
                    <ul>
                        <li class="nav-item active">
                            <a href="#generate" onclick="showSection('generate')">
                                <i class="fas fa-plus-circle"></i>
                                <span>新建报告</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#history" onclick="showSection('history')">
                                <i class="fas fa-history"></i>
                                <span>历史记录</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#settings" onclick="showSection('settings')">
                                <i class="fas fa-cog"></i>
                                <span>系统设置</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3>快速操作</h3>
                    <ul>
                        <li class="nav-item">
                            <a href="#templates" onclick="showSection('templates')">
                                <i class="fas fa-file-alt"></i>
                                <span>报告模板</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#about" onclick="showSection('about')">
                                <i class="fas fa-info-circle"></i>
                                <span>关于系统</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            
            <!-- 系统状态 -->
            <div class="system-status">
                <div class="status-item">
                    <div class="status-indicator online"></div>
                    <span>AI服务正常</span>
                </div>
                <div class="status-info">
                    <small>当前模式: <span id="currentMode">演示模式</span></small>
                </div>
            </div>
        </aside>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 顶部栏 -->
            <header class="top-bar">
                <div class="top-bar-left">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="pageTitle">新建报告</h1>
                </div>
                <div class="top-bar-right">
                    <div class="ai-provider-selector">
                        <label for="aiProvider">AI模式:</label>
                        <select id="aiProvider" onchange="updateModels()">
                            <option value="demo">演示模式</option>
                            <option value="openai">OpenAI</option>
                            <option value="vllm">本地vLLM</option>
                        </select>
                    </div>
                    <div class="user-actions">
                        <button class="btn-icon" title="帮助">
                            <i class="fas fa-question-circle"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- 内容区域 -->
            <div class="content-area">
                <!-- 新建报告页面 -->
                <section id="generate" class="content-section active">
                    <div class="wizard-container">
                        <!-- 进度指示器 -->
                        <div class="progress-bar">
                            <div class="step-indicator active">
                                <div class="step-number">1</div>
                                <div class="step-title">研究方向</div>
                            </div>
                            <div class="step-indicator">
                                <div class="step-number">2</div>
                                <div class="step-title">研究角度</div>
                            </div>
                            <div class="step-indicator">
                                <div class="step-number">3</div>
                                <div class="step-title">配置报告</div>
                            </div>
                            <div class="step-indicator">
                                <div class="step-number">4</div>
                                <div class="step-title">生成报告</div>
                            </div>
                        </div>

                        <!-- 步骤1：研究主题 -->
                        <div class="wizard-step active" id="step1">
                            <div class="step-card">
                                <div class="step-header">
                                    <h2><i class="fas fa-lightbulb"></i> 确定研究方向</h2>
                                    <p>请输入您想要研究的主题或上传相关文档</p>
                                </div>
                                
                                <div class="step-content">
                                    <div class="form-group">
                                        <label for="research-topic">研究主题</label>
                                        <textarea 
                                            id="research-topic" 
                                            placeholder="请输入您的研究主题，例如：人工智能在医疗领域的应用前景..."
                                            rows="4"
                                            maxlength="500"
                                        ></textarea>
                                        <div class="char-counter">
                                            <span id="charCount">0</span>/500 字符 (最少10字符)
                                        </div>
                                    </div>
                                    
                                    <div class="file-upload-area" onclick="document.getElementById('fileInput').click()">
                                        <div class="upload-placeholder">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                            <p>点击上传或拖拽文件到这里</p>
                                            <small>支持 PDF, DOC, DOCX, TXT 格式，最大 16MB</small>
                                        </div>
                                        <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.txt" style="display: none;">
                                        <div id="uploadedFiles" class="uploaded-files"></div>
                                    </div>
                                    
                                    <div class="step-actions">
                                        <button class="btn-primary" onclick="nextStep(2)" id="step1Next" disabled>
                                            <i class="fas fa-arrow-right"></i> 下一步：设定研究角度
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 步骤2：研究角度 -->
                        <div class="wizard-step" id="step2">
                            <div class="step-card">
                                <div class="step-header">
                                    <h2><i class="fas fa-compass"></i> 选择研究角度</h2>
                                    <p>根据您的主题，选择或自定义研究的角度和方向</p>
                                </div>
                                
                                <div class="step-content">
                                    <div class="angle-suggestions" id="angleSuggestions">
                                        <!-- 动态生成研究角度建议 -->
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="custom-angle">自定义研究角度</label>
                                        <textarea 
                                            id="custom-angle" 
                                            placeholder="描述您独特的研究视角、关注点或分析框架..."
                                            rows="3"
                                        ></textarea>
                                    </div>
                                    
                                    <div class="step-actions">
                                        <button class="btn-secondary" onclick="prevStep(1)">
                                            <i class="fas fa-arrow-left"></i> 上一步
                                        </button>
                                        <button class="btn-primary" onclick="nextStep(3)" id="step2Next">
                                            <i class="fas fa-arrow-right"></i> 下一步：配置报告
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 步骤3：报告配置 -->
                        <div class="wizard-step" id="step3">
                            <div class="step-card">
                                <div class="step-header">
                                    <h2><i class="fas fa-sliders-h"></i> 配置报告参数</h2>
                                    <p>设置报告的类型、长度和输出格式</p>
                                </div>
                                
                                <div class="step-content">
                                    <div class="config-grid">
                                        <div class="config-group">
                                            <label for="reportType">报告类型</label>
                                            <select id="reportType">
                                                <option value="research">研究报告 - 学术性强，深度分析</option>
                                                <option value="analysis">分析报告 - 数据导向，客观评估</option>
                                                <option value="technical">技术文档 - 技术细节，实用指南</option>
                                                <option value="business">商业计划 - 商业价值，实施方案</option>
                                            </select>
                                        </div>
                                        
                                        <div class="config-group">
                                            <label for="reportLength">报告长度</label>
                                            <select id="reportLength">
                                                <option value="short">简要版 (5-10页)</option>
                                                <option value="medium" selected>标准版 (15-25页)</option>
                                                <option value="long">详细版 (30-50页)</option>
                                            </select>
                                        </div>
                                        
                                        <div class="config-group">
                                            <label for="aiModel">AI模型</label>
                                            <select id="aiModel">
                                                <option value="demo-model">演示模型</option>
                                            </select>
                                        </div>
                                        
                                        <div class="config-group">
                                            <label>输出格式</label>
                                            <div class="format-grid">
                                                <label class="format-option">
                                                    <input type="checkbox" name="formats" value="markdown" checked>
                                                    <div class="format-card">
                                                        <i class="fab fa-markdown"></i>
                                                        <span>Markdown</span>
                                                    </div>
                                                </label>
                                                <label class="format-option">
                                                    <input type="checkbox" name="formats" value="json">
                                                    <div class="format-card">
                                                        <i class="fas fa-code"></i>
                                                        <span>JSON</span>
                                                    </div>
                                                </label>
                                                <label class="format-option">
                                                    <input type="checkbox" name="formats" value="docx">
                                                    <div class="format-card">
                                                        <i class="fas fa-file-word"></i>
                                                        <span>Word</span>
                                                    </div>
                                                </label>
                                                <label class="format-option">
                                                    <input type="checkbox" name="formats" value="pdf">
                                                    <div class="format-card">
                                                        <i class="fas fa-file-pdf"></i>
                                                        <span>PDF</span>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="feature-toggles">
                                        <div class="toggle-group">
                                            <label class="toggle-label">
                                                <input type="checkbox" id="enableCharts" checked>
                                                <span class="toggle-slider"></span>
                                                <div class="toggle-info">
                                                    <strong>启用图表生成</strong>
                                                    <small>自动生成相关的数据可视化图表</small>
                                                </div>
                                            </label>
                                        </div>
                                        
                                        <div class="toggle-group">
                                            <label class="toggle-label">
                                                <input type="checkbox" id="enablePolish" checked>
                                                <span class="toggle-slider"></span>
                                                <div class="toggle-info">
                                                    <strong>启用内容润色</strong>
                                                    <small>使用AI优化语言表达和逻辑结构</small>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="step-actions">
                                        <button class="btn-secondary" onclick="prevStep(2)">
                                            <i class="fas fa-arrow-left"></i> 上一步
                                        </button>
                                        <button class="btn-primary" onclick="nextStep(4)" id="step3Next">
                                            <i class="fas fa-arrow-right"></i> 下一步：生成报告
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 步骤4：生成报告 -->
                        <div class="wizard-step" id="step4">
                            <div class="step-card">
                                <div class="step-header">
                                    <h2><i class="fas fa-magic"></i> 生成报告</h2>
                                    <p>系统正在使用多智能体协作生成您的报告</p>
                                </div>
                                
                                <div class="step-content">
                                    <!-- 配置摘要 -->
                                    <div id="configSummary" class="config-summary">
                                        <!-- 动态生成配置摘要 -->
                                    </div>
                                    
                                    <!-- 生成进度 -->
                                    <div class="generation-progress" id="generationProgress" style="display: none;">
                                        <div class="progress-header">
                                            <h3><i class="fas fa-cogs"></i> 生成进度</h3>
                                            <div class="estimated-time">预计耗时: <span id="estimatedTime">5-10分钟</span></div>
                                        </div>
                                        
                                        <div class="agent-progress">
                                            <div class="agent-step" id="outlineStep">
                                                <div class="agent-icon"><i class="fas fa-list"></i></div>
                                                <div class="agent-info">
                                                    <h4>大纲生成智能体</h4>
                                                    <p>正在分析主题并生成报告结构...</p>
                                                </div>
                                                <div class="agent-status pending">
                                                    <i class="fas fa-clock"></i>
                                                </div>
                                            </div>
                                            
                                            <div class="agent-step" id="contentStep">
                                                <div class="agent-icon"><i class="fas fa-edit"></i></div>
                                                <div class="agent-info">
                                                    <h4>内容生成智能体</h4>
                                                    <p>正在为各章节撰写详细内容...</p>
                                                </div>
                                                <div class="agent-status pending">
                                                    <i class="fas fa-clock"></i>
                                                </div>
                                            </div>
                                            
                                            <div class="agent-step" id="chartStep">
                                                <div class="agent-icon"><i class="fas fa-chart-bar"></i></div>
                                                <div class="agent-info">
                                                    <h4>图表生成智能体</h4>
                                                    <p>正在生成相关的数据可视化图表...</p>
                                                </div>
                                                <div class="agent-status pending">
                                                    <i class="fas fa-clock"></i>
                                                </div>
                                            </div>
                                            
                                            <div class="agent-step" id="polishStep">
                                                <div class="agent-icon"><i class="fas fa-magic"></i></div>
                                                <div class="agent-info">
                                                    <h4>润色智能体</h4>
                                                    <p>正在优化语言表达和逻辑结构...</p>
                                                </div>
                                                <div class="agent-status pending">
                                                    <i class="fas fa-clock"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 生成结果 -->
                                    <div class="generation-result" id="generationResult" style="display: none;">
                                        <div class="result-header">
                                            <h3><i class="fas fa-check-circle text-success"></i> 生成完成</h3>
                                            <div class="result-stats">
                                                <span class="stat-item">
                                                    <i class="fas fa-clock"></i>
                                                    用时: <span id="generationTime">2分30秒</span>
                                                </span>
                                                <span class="stat-item">
                                                    <i class="fas fa-file-alt"></i>
                                                    字数: <span id="wordCount">约8,500字</span>
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div class="download-links" id="downloadLinks">
                                            <!-- 动态生成下载链接 -->
                                        </div>
                                    </div>
                                    
                                    <div class="step-actions">
                                        <button class="btn-secondary" onclick="prevStep(3)">
                                            <i class="fas fa-arrow-left"></i> 上一步
                                        </button>
                                        <button class="btn-primary" onclick="generateReport()" id="generateBtn">
                                            <i class="fas fa-magic"></i> 开始生成报告
                                        </button>
                                        <button class="btn-primary" onclick="resetWizard()" id="newReportBtn" style="display: none;">
                                            <i class="fas fa-plus"></i> 生成新报告
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 其他页面内容 -->
                <section id="history" class="content-section">
                    <h2>历史记录</h2>
                    <p>这里将显示生成历史记录...</p>
                </section>

                <section id="settings" class="content-section">
                    <h2>系统设置</h2>
                    <p>这里将显示系统设置选项...</p>
                </section>

                <section id="templates" class="content-section">
                    <h2>报告模板</h2>
                    <p>这里将显示预定义的报告模板...</p>
                </section>

                <section id="about" class="content-section">
                    <h2>关于系统</h2>
                    <div class="about-content">
                        <h3>🤖 多智能体报告生成系统</h3>
                        <p>这是一个基于多智能体协作的自动化报告生成系统，通过不同功能的智能体协作完成报告的撰写工作。</p>
                        
                        <h4>✨ 核心特性</h4>
                        <ul>
                            <li>🎯 智能大纲生成：自动分析主题并生成逻辑结构</li>
                            <li>✍️ 多智能体协作：4个专业智能体分工合作</li>
                            <li>📊 图表自动生成：根据内容生成相关可视化图表</li>
                            <li>🎨 内容智能润色：自动优化语言表达和逻辑结构</li>
                            <li>📄 多格式输出：支持Markdown、Word、PDF、JSON等格式</li>
                        </ul>
                        
                        <h4>🤖 智能体团队</h4>
                        <ul>
                            <li><strong>大纲生成智能体</strong>：负责根据主题生成报告大纲</li>
                            <li><strong>内容生成智能体</strong>：负责撰写各章节具体内容</li>
                            <li><strong>润色智能体</strong>：负责对内容进行语言优化</li>
                            <li><strong>图表生成智能体</strong>：负责生成数据可视化图表</li>
                        </ul>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- 通知系统 -->
    <div id="notification-container"></div>

    <!-- 加载脚本 -->
    <script src="unified_state_manager.js"></script>
    <script src="script_improved.js"></script>
    <script src="step_navigator_rewrite.js"></script>
    
    <!-- 修复脚本冲突 -->
    <script>
        // 确保正确的事件绑定
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔧 修复脚本冲突...');
            
            // 等待所有脚本加载完成
            setTimeout(function() {
                // 重新绑定步骤4的生成按钮
                const generateBtn = document.getElementById('generateBtn');
                if (generateBtn) {
                    // 移除所有旧的事件监听器
                    generateBtn.replaceWith(generateBtn.cloneNode(true));
                    const newGenerateBtn = document.getElementById('generateBtn');
                    
                    // 绑定统一的生成函数
                    newGenerateBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        console.log('🎯 点击生成报告按钮');
                        
                        // 收集当前配置
                        const topic = document.getElementById('research-topic')?.value?.trim() || '';
                        const customAngle = document.getElementById('custom-angle')?.value?.trim() || '';
                        const reportType = document.querySelector('input[name="reportType"]:checked')?.value || 'research';
                        const reportLength = document.querySelector('input[name="reportLength"]:checked')?.value || 'medium';
                        
                        // 收集格式
                        const formats = [];
                        document.querySelectorAll('input[name="format"]:checked').forEach(checkbox => {
                            formats.push(checkbox.value);
                        });
                        
                        // 收集选项
                        const enableCharts = document.getElementById('enable-charts')?.checked || false;
                        const enablePolish = document.getElementById('enable-polish')?.checked || false;
                        
                        // 更新统一状态
                        window.UnifiedState.updateConfig({
                            topic: topic,
                            angle: customAngle,
                            type: reportType,
                            length: reportLength,
                            formats: formats.length > 0 ? formats : ['markdown'],
                            enableCharts: enableCharts,
                            enablePolish: enablePolish
                        });
                        
                        // 生成报告
                        window.UnifiedState.generateReport();
                    });
                    
                    console.log('✅ 重新绑定生成按钮事件');
                }
            }, 1000);
        });
    </script>
</body>
</html>
